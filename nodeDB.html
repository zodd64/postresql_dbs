Drop table IF EXISTS GRAPHNODE cascade;
Drop table IF EXISTS PROPERTYLINK cascade;
Drop tabLE IF EXISTS FOLLOWS cascade;

DROP TYPE IF EXISTS PTYXIO CASCADE;
DROP TYPE IF EXISTS FYLLO CASCADE;
DROP TYPE IF EXISTS ADDRESS CASCADE;

CREATE TYPE PTYXIO AS ENUM ('Επιστήμης Υπολογιστών','Μηχανικών Πληροφορικής');
CREATE TYPE FYLLO AS ENUM ('Άνδρας','Γυναίκα');
CREATE TYPE ADDRESS AS (
POLH VARCHAR(60),
CODE VARCHAR(60),
XORA VARCHAR(60)
);

CREATE TABLE GRAPHNODE (
NODEKEY VARCHAR(30) NOT NULL,
FACET VARCHAR(30),
PRIMARY KEY(NODEKEY));

CREATE TABLE USERS (
PRIMARY KEY(NODEKEY),
ONOMA VARCHAR(60),
EPONYMO VARCHAR(120),
TITLOS PTYXIO,
GENOS FYLLO,
TELEPHONE text [],
DIAMONH ADDRESS)
INHERITS (GRAPHNODE);

CREATE TABLE OMADA
(PRIMARY KEY (NODEKEY),
ONOMA_OMADAS VARCHAR(100) NOT NULL,
PERIGRAFH VARCHAR(400) NOT NULL,
UNIQUE (ONOMA_OMADAS),
HMER_DHMIOYRGIAS DATE NOT NULL
)INHERITS (GRAPHNODE);

CREATE TABLE PROPERTYLINK (
NODEKEY1 VARCHAR(30) NOT NULL,
NODEKEY2 VARCHAR(30) NOT NULL,
PROPERTYLABEL VARCHAR(30) NOT NULL,
HMEROMHNIA DATE,
FOREIGN KEY (NODEKEY1) REFERENCES GRAPHNODE (NODEKEY),
FOREIGN KEY (NODEKEY2) REFERENCES GRAPHNODE (NODEKEY),
PRIMARY KEY (NODEKEY1, NODEKEY2, PROPERTYLABEL));

CREATE TABLE MESSAGES
(SYG_MHNYMATOS VARCHAR(30) NOT NULL,
KOD_MHNYMATOS INT NOT NULL,
IDIOKTHTHS_TOIXOY VARCHAR(30) NOT NULL,
PERIEXOMENO VARCHAR(4000) NOT NULL,
CHECK (KOD_MHNYMATOS > 0 ),
FOREIGN KEY (IDIOKTHTHS_TOIXOY) REFERENCES USERS (NODEKEY),
FOREIGN KEY (SYG_MHNYMATOS) REFERENCES USERS (NODEKEY),
PRIMARY KEY (SYG_MHNYMATOS,KOD_MHNYMATOS)
)INHERITS (GRAPHNODE);

CREATE TABLE COMENTS
(SYG_MHNYMATOS VARCHAR(30) NOT NULL,
KOD_MHNYMATOS INT NOT NULL,
KOD_SXOLIOU INT NOT NULL,
SUGGRAFEAS_SXOLIOU VARCHAR(30) NOT NULL,
KEIMENO_SXOLIOU VARCHAR(4000) NOT NULL,
CHECK (KOD_MHNYMATOS > 0 ),
CHECK (KOD_SXOLIOU > 0 ),
FOREIGN KEY (SYG_MHNYMATOS) REFERENCES USERS (NODEKEY),
FOREIGN KEY (SYG_MHNYMATOS,KOD_MHNYMATOS) REFERENCES MESSAGES (SYG_MHNYMATOS,KOD_MHNYMATOS),
PRIMARY KEY (SYG_MHNYMATOS,KOD_MHNYMATOS ,KOD_SXOLIOU)
)INHERITS (GRAPHNODE);

CREATE TABLE FOLLOWS(
NODEKEY VARCHAR(30) NOT NULL,
OUTGOING VARCHAR(30)[],
INCOMING VARCHAR(30)[],
HMEROMHNIA DATE NOT NULL,
FOREIGN KEY(NODEKEY) REFERENCES GRAPHNODE(NODEKEY),
PRIMARY KEY(NODEKEY));

INSERT INTO GRAPHNODE VALUES ('demosthenes', 'Tutor');
INSERT INTO GRAPHNODE VALUES ('ktistakis', 'Tutor');
INSERT INTO GRAPHNODE VALUES ('odysseas','Student');
INSERT INTO GRAPHNODE VALUES ('M1', 'message');
INSERT INTO GRAPHNODE VALUES ('M2', 'message');
INSERT INTO GRAPHNODE VALUES ('C1', 'comment');
INSERT INTO GRAPHNODE VALUES ('C2', 'comment');
INSERT INTO GRAPHNODE VALUES ('O1', 'omada');
INSERT INTO GRAPHNODE VALUES ('O2', 'omada');

/* Εισαγωγή εγγραφών στον Πίνακα {ΧΡΗΣΤΗΣ} μετά τους νέους τύπους δεδομένων */
INSERT INTO USERS VALUES ('demosthenes', 'Tutor', 'Δημοσθένης', 'Ακουμιανάκης', 'Μηχανικών Πληροφορικής', 'Άνδρας', '{2810379190, 6973359242}', ROW('Ηράκλειο', '71500', 'Ελλάς'));
INSERT INTO USERS VALUES ('ktistakis', 'Tutor', 'Γιώργος', 'Κτιστάκης', 'Μηχανικών Πληροφορικής', 'Άνδρας', '{2810321040, 6978559242}', ROW('Χανιά', '23100', 'Ελλάς'));

/* Εισαγωγή εγγραφών στον Πίνακα {PROPERTYLINK} */
INSERT INTO PROPERTYLINK VALUES ('demosthenes', 'M1', 'POSTS', TO_DATE('16/03/2016 13:00', 'dd/mm/yyyy'));
INSERT INTO PROPERTYLINK VALUES ('ktistakis', 'M2', 'POSTS', TO_DATE('16/03/2016 13:00', 'dd/mm/yyyy'));
INSERT INTO PROPERTYLINK VALUES ('M1', 'ktistakis', 'WRITTEN_ON_WALL', TO_DATE('16/03/2016 13:00', 'dd/mm/yyyy'));
INSERT INTO PROPERTYLINK VALUES ('M2', 'ktistakis', 'WRITTEN_ON_WALL', TO_DATE('16/03/2016 13:00', 'dd/mm/yyyy'));
INSERT INTO PROPERTYLINK VALUES ('ktistakis', 'C1', 'COMMENTS', TO_DATE('16/03/2016 18:10', 'dd/mm/yyyy'));
INSERT INTO PROPERTYLINK VALUES ('demosthenes', 'C2', 'COMMENTS', TO_DATE('16/03/2016 18:10', 'dd/mm/yyyy'));
INSERT INTO PROPERTYLINK VALUES ('C1', 'M1', 'RELATES_TO', TO_DATE('16/03/2016 18:10', 'dd/mm/yyyy'));
INSERT INTO PROPERTYLINK VALUES ('C2', 'M2', 'RELATES_TO', TO_DATE('16/03/2016 18:10', 'dd/mm/yyyy'));
INSERT INTO PROPERTYLINK VALUES ('ktistakis', 'M1', 'LIKES', NULL);
INSERT INTO PROPERTYLINK VALUES ('ktistakis', 'O1', 'MEMBER', TO_DATE('16/03/2016', 'dd/mm/yyyy'));
INSERT INTO PROPERTYLINK VALUES ('demosthenes', 'O1', 'ADMINS', NULL);
INSERT INTO PROPERTYLINK VALUES ('demosthenes', 'O2', 'ADMINS', NULL);

/* Εισαγωγή εγγραφών στον Πίνακα {ΜΗΝΥΜΑ} */
INSERT INTO MESSAGES VALUES ('1','message','demosthenes', 1, 'demosthenes', 'Παρακαλώ να ετοιμαστούν οι υπολογιστές του εργαστηρίου 5ΠΚ');
INSERT INTO MESSAGES VALUES ('2','message','ktistakis', 2, 'ktistakis', 'Οι φοιτητές θα πρέπει να χρησιμοποιήσουν τον κωδικό 1234 για πρόσβαση στην PostgreSQL');

/* Εισαγωγή εγγραφών στον Πίνακα {ΣΧΟΛΙΟ} */
INSERT INTO COMENTS VALUES ('1','comment','demosthenes', 1, 1, 'ktistakis', 'Εχω ήδη εγκαταστήσει την PostgrSQL σε όλους τους υπολογιστές');
INSERT INTO COMENTS VALUES ('2','comment','ktistakis', 2, 2, 'demosthenes', 'Ωραία, ελπίζουν να πάνε όλα καλά');

/* Εισαγωγή εγγραφών στον Πίνακα {ΟΜΑΔΑ} */
INSERT INTO OMADA VALUES ('O1','omada', 'Εργαστηριακή ομάδα 1', '13.00-15.00', TO_DATE('16/03/2016', 'dd/mm/yyyy'));
INSERT INTO OMADA VALUES ('O2','omada', 'Εργαστηριακή ομάδα 2', '15.00-17.00', TO_DATE('16/03/2016', 'dd/mm/yyyy'));

/* ΕΙΣΑΓΩΓΕΣ ΣΤΟΝ ΠΙΝΑΚΑ FOLLOWS */
INSERT INTO FOLLOWS VALUES('demosthenes',ARRAY['ktistakis'],NULL,TO_DATE('16/03/2016', 'dd/mm/yyyy'));
 
